# FunASR å¿«é€Ÿé…ç½®æŒ‡å—

## âš ï¸ é‡è¦æç¤º

**å¿…é¡»åœ¨ `config.json` ä¸­è®¾ç½® `"voice_to_text": "funasr"` æ‰èƒ½ä½¿ç”¨ FunASRï¼**

å¦‚æœä¸è®¾ç½®ï¼Œç³»ç»Ÿä¼šä½¿ç”¨é»˜è®¤çš„ OpenAI Whisper å¼•æ“ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ FunASR æœåŠ¡

#### ä½¿ç”¨ SenseVoiceï¼ˆå¤šè¯­è¨€ + æƒ…æ„Ÿè¯†åˆ«ï¼‰

```bash
docker run -d \
  --name funasr-sensevoice \
  -p 10095:10095 \
  registry.cn-hangzhou.aliyuncs.com/funasr_repo/funasr:funasr-runtime-sdk-online-cpu-0.1.10
```

#### ä½¿ç”¨ Paraformerï¼ˆé«˜ç²¾åº¦ä¸­æ–‡ï¼‰

```bash
docker run -d \
  --name funasr-paraformer \
  -p 10096:10096 \
  registry.cn-hangzhou.aliyuncs.com/funasr_repo/funasr:funasr-runtime-sdk-online-cpu-0.1.10
```

### ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ config.json

#### é…ç½® SenseVoice

```json
{
  "voice_to_text": "funasr",
  "speech_recognition": true,
  "funasr_url": "ws://localhost:10095",
  "funasr_model": "sensevoice",
  "funasr_enable_itn": true
}
```

#### é…ç½® Paraformer

```json
{
  "voice_to_text": "funasr",
  "speech_recognition": true,
  "funasr_url": "ws://localhost:10096",
  "funasr_model": "paraformer",
  "funasr_enable_itn": true,
  "funasr_hotwords": "ä¼ä¸šå¾®ä¿¡ Dify äººå·¥æ™ºèƒ½"
}
```

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
pip install websockets
```

### ç¬¬å››æ­¥ï¼šé‡å¯æœåŠ¡

```bash
python app.py
```

## ğŸ“‹ é…ç½®å‚æ•°è¯´æ˜

| å‚æ•° | æ˜¯å¦å¿…å¡« | è¯´æ˜ | SenseVoice | Paraformer |
|------|---------|------|------------|------------|
| `voice_to_text` | âœ… **å¿…å¡«** | å¿…é¡»è®¾ç½®ä¸º `"funasr"` | âœ… | âœ… |
| `speech_recognition` | âœ… **å¿…å¡«** | æ˜¯å¦å¼€å¯è¯­éŸ³è¯†åˆ« | `true` | `true` |
| `funasr_url` | âš™ï¸ å¯é€‰ | WebSocket åœ°å€ | `ws://localhost:10095` | `ws://localhost:10096` |
| `funasr_model` | âš™ï¸ å¯é€‰ | æ¨¡å‹åç§° | `sensevoice` | `paraformer` |
| `funasr_enable_itn` | âš™ï¸ å¯é€‰ | æ•°å­—è½¬æ¢ | âœ… | âœ… |
| `funasr_hotwords` | âš™ï¸ å¯é€‰ | çƒ­è¯ï¼ˆæé«˜è¯†åˆ«ç‡ï¼‰ | âŒ | âœ… |
| `funasr_audio_fs` | âš™ï¸ å¯é€‰ | é‡‡æ ·ç‡ | `16000` | `16000` |

## ğŸ¯ æ¨¡å‹é€‰æ‹©å»ºè®®

### é€‰æ‹© SenseVoice çš„åœºæ™¯ï¼š
- âœ… éœ€è¦è¯†åˆ«å¤šç§è¯­è¨€ï¼ˆä¸­è‹±æ—¥éŸ©ç²¤ï¼‰
- âœ… éœ€è¦æƒ…æ„Ÿåˆ†æ
- âœ… å®æ—¶å¯¹è¯åœºæ™¯
- âœ… ä¸ç¡®å®šç”¨æˆ·ä¼šè¯´ä»€ä¹ˆè¯­è¨€

### é€‰æ‹© Paraformer çš„åœºæ™¯ï¼š
- âœ… çº¯ä¸­æ–‡åœºæ™¯
- âœ… éœ€è¦é«˜ç²¾åº¦è¯†åˆ«ï¼ˆä¼šè®®è®°å½•ã€æ–‡ä»¶è½¬å†™ï¼‰
- âœ… éœ€è¦è‡ªåŠ¨æ ‡ç‚¹ç¬¦å·
- âœ… æœ‰ä¸“ä¸šæœ¯è¯­éœ€è¦è¯†åˆ«ï¼ˆå¯ä½¿ç”¨çƒ­è¯ï¼‰

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé…ç½®äº† FunASR ä½†è¿˜æ˜¯ç”¨çš„ OpenAIï¼Ÿ

**ç­”ï¼šå¿…é¡»åœ¨ `config.json` ä¸­è®¾ç½® `"voice_to_text": "funasr"`ï¼**

å¦‚æœä¸è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œç³»ç»Ÿä¼šä½¿ç”¨é»˜è®¤çš„ OpenAI Whisper å¼•æ“ã€‚

```json
{
  "voice_to_text": "funasr",  // â† è¿™ä¸ªå¿…é¡»å¡«ï¼
  "speech_recognition": true,
  "funasr_url": "ws://localhost:10095"
}
```

### Q2: å¦‚ä½•æµ‹è¯• FunASR æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ

```bash
# æµ‹è¯• SenseVoice
python voice/funasr/funasr_api.py test.wav sensevoice

# æµ‹è¯• Paraformer
python voice/funasr/funasr_api.py test.wav paraformer
```

### Q3: è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œï¼š
```bash
docker ps | grep funasr
```

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
docker logs funasr-sensevoice
# æˆ–
docker logs funasr-paraformer
```

### Q3: å¦‚ä½•ä½¿ç”¨çƒ­è¯ï¼Ÿ

çƒ­è¯ä»… Paraformer æ”¯æŒï¼Œåœ¨ config.json ä¸­é…ç½®ï¼š

```json
{
  "funasr_hotwords": "äººå·¥æ™ºèƒ½ æ·±åº¦å­¦ä¹  ç¥ç»ç½‘ç»œ ä¼ä¸šå¾®ä¿¡ Dify"
}
```

**æ³¨æ„ï¼š**
- çƒ­è¯ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”
- å»ºè®® 10-20 ä¸ªçƒ­è¯
- çƒ­è¯åº”è¯¥æ˜¯å®Œæ•´çš„è¯è¯­

### Q4: ITN æ˜¯ä»€ä¹ˆï¼Ÿ

ITNï¼ˆé€†æ–‡æœ¬å½’ä¸€åŒ–ï¼‰å°†æ–‡å­—æ•°å­—è½¬æ¢ä¸ºé˜¿æ‹‰ä¼¯æ•°å­—ï¼š

- âœ… å¯ç”¨ ITNï¼š`"funasr_enable_itn": true`
  - "ä¸€åƒäºŒç™¾" â†’ "1200"
  - "äºŒé›¶äºŒä¸‰å¹´" â†’ "2023å¹´"
  
- âŒ ç¦ç”¨ ITNï¼š`"funasr_enable_itn": false`
  - ä¿æŒåŸå§‹æ–‡å­—å½¢å¼

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| ç‰¹æ€§ | SenseVoice | Paraformer |
|------|------------|------------|
| è¯­è¨€æ”¯æŒ | ä¸­è‹±æ—¥éŸ©ç²¤ | ä»…ä¸­æ–‡ |
| è¯†åˆ«å‡†ç¡®ç‡ | è¾ƒé«˜ | æé«˜ï¼ˆCER 1.95%ï¼‰ |
| æ ‡ç‚¹ç¬¦å· | âœ… | âœ… |
| æƒ…æ„Ÿè¯†åˆ« | âœ… | âŒ |
| çƒ­è¯æ”¯æŒ | âŒ | âœ… |
| é€‚ç”¨åœºæ™¯ | å®æ—¶å¯¹è¯ | ä¼šè®®è½¬å†™ |

## ğŸ”— ç›¸å…³æ–‡æ¡£

- è¯¦ç»†æ–‡æ¡£ï¼š`voice/funasr/README.md`
- SenseVoice API è§„åˆ™ï¼š`rules/sensevoice_api_rules.md`
- Paraformer API è§„åˆ™ï¼š`rules/paraformer_api_rules.md`
- FunASR å®˜æ–¹ï¼šhttps://github.com/alibaba/FunASR

## ğŸ’¡ å®Œæ•´é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä¼ä¸šå¾®ä¿¡ + SenseVoiceï¼ˆå¤šè¯­è¨€åœºæ™¯ï¼‰

```json
{
  "channel_type": "wechatcom_app",
  "model": "dify",
  "voice_to_text": "funasr",
  "speech_recognition": true,
  "group_speech_recognition": true,
  
  "funasr_url": "ws://localhost:10095",
  "funasr_model": "sensevoice",
  "funasr_enable_itn": true,
  "funasr_audio_fs": 16000,
  
  "dify_api_key": "your-dify-api-key",
  "dify_api_base": "https://api.dify.ai/v1",
  
  "wechatcom_corp_id": "your-corp-id",
  "wechatcomapp_secret": "your-secret",
  "wechatcomapp_agent_id": "your-agent-id"
}
```

### ç¤ºä¾‹ 2ï¼šä¼ä¸šå¾®ä¿¡ + Paraformerï¼ˆé«˜ç²¾åº¦ä¸­æ–‡ï¼‰

```json
{
  "channel_type": "wechatcom_app",
  "model": "dify",
  "voice_to_text": "funasr",
  "speech_recognition": true,
  "group_speech_recognition": true,
  
  "funasr_url": "ws://localhost:10096",
  "funasr_model": "paraformer",
  "funasr_enable_itn": true,
  "funasr_hotwords": "ä¼ä¸šå¾®ä¿¡ Dify äººå·¥æ™ºèƒ½ æ·±åº¦å­¦ä¹ ",
  "funasr_audio_fs": 16000,
  
  "dify_api_key": "your-dify-api-key",
  "dify_api_base": "https://api.dify.ai/v1",
  
  "wechatcom_corp_id": "your-corp-id",
  "wechatcomapp_secret": "your-secret",
  "wechatcomapp_agent_id": "your-agent-id"
}
```

