# ä¼ä¸šå¾®ä¿¡æ™ºèƒ½æœºå™¨äºº - å¿«é€Ÿé…ç½®æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### æ­¥éª¤ 1: åˆ›å»ºæ™ºèƒ½æœºå™¨äºº

1. ç™»å½• [ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°](https://work.weixin.qq.com/)
2. è¿›å…¥ã€Œåº”ç”¨ç®¡ç†ã€â†’ã€Œæ™ºèƒ½æœºå™¨äººã€
3. ç‚¹å‡»ã€Œåˆ›å»ºæ™ºèƒ½æœºå™¨äººã€
4. å¡«å†™æœºå™¨äººåç§°å’Œæè¿°
5. å¼€å¯ã€ŒAPI æ¨¡å¼ã€

### æ­¥éª¤ 2: è·å–é…ç½®ä¿¡æ¯

åœ¨æ™ºèƒ½æœºå™¨äººçš„ã€Œæ¥æ”¶æ¶ˆæ¯ã€é…ç½®é¡µé¢ï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
Token: your-token-here
EncodingAESKey: your-aes-key-here
```

**æ³¨æ„ï¼š** æ™ºèƒ½æœºå™¨äººä½¿ç”¨è¢«åŠ¨å›å¤æ¨¡å¼ï¼Œ**ä¸éœ€è¦** Secret å’Œ aibot_idï¼

### æ­¥éª¤ 3: é…ç½® config.json

å¤åˆ¶ `config.json.template` ä¸º `config.json`ï¼Œå¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š

```json
{
  "channel_type": "wechatcom_aibot",

  "wechatcom_corp_id": "ww1234567890abcdef",
  "wechatcom_aibot_token": "your-token-here",
  "wechatcom_aibot_aes_key": "your-aes-key-here",
  "wechatcom_aibot_port": 9899,

  "model": "dify",
  "dify_api_key": "your-dify-api-key"
}
```

### æ­¥éª¤ 4: é…ç½®å›è°ƒ URL

åœ¨ä¼ä¸šå¾®ä¿¡æ™ºèƒ½æœºå™¨äººç®¡ç†åå°ï¼Œé…ç½®å›è°ƒ URLï¼š

```
http://ä½ çš„æœåŠ¡å™¨IP:9899/wxaibot/
```

**æœ¬åœ°æµ‹è¯•ï¼š** å¯ä»¥ä½¿ç”¨ ngrok æˆ– frp è¿›è¡Œå†…ç½‘ç©¿é€

```bash
# ä½¿ç”¨ ngrok
ngrok http 9899

# ç„¶åä½¿ç”¨ ngrok æä¾›çš„ URL
https://xxxx.ngrok.io/wxaibot/
```

### æ­¥éª¤ 5: å¯åŠ¨æœåŠ¡

```bash
python app.py
```

çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š

```
[wechatcom_aibot] Initializing: corp_id=ww..., aibot_id=AIBOTID_...
[wechatcom_aibot] Starting web server on port 9899
```

### æ­¥éª¤ 6: éªŒè¯ URL

åœ¨ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°ç‚¹å‡»ã€Œä¿å­˜ã€ï¼Œç³»ç»Ÿä¼šéªŒè¯ URL æœ‰æ•ˆæ€§ã€‚

âœ… éªŒè¯æˆåŠŸï¼šæ˜¾ç¤ºã€ŒéªŒè¯æˆåŠŸã€
âŒ éªŒè¯å¤±è´¥ï¼šæ£€æŸ¥é…ç½®å’Œæ—¥å¿—

### æ­¥éª¤ 7: æµ‹è¯•å¯¹è¯

1. åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ‰¾åˆ°ä½ çš„æ™ºèƒ½æœºå™¨äºº
2. å‘é€æ¶ˆæ¯ï¼š`ä½ å¥½`
3. æœºå™¨äººåº”è¯¥ä¼šå›å¤

## ğŸ“‹ å®Œæ•´é…ç½®ç¤ºä¾‹

### æœ€å°é…ç½®ï¼ˆä»…æ–‡æœ¬å¯¹è¯ï¼‰

```json
{
  "channel_type": "wechatcom_aibot",
  "wechatcom_corp_id": "ww1234567890abcdef",
  "wechatcom_aibot_token": "your-token",
  "wechatcom_aibot_aes_key": "your-aes-key",
  "model": "dify",
  "dify_api_key": "your-dify-api-key"
}
```

### å®Œæ•´é…ç½®ï¼ˆåŒ…å«è¯­éŸ³è¯†åˆ«ï¼‰

**æ³¨æ„ï¼š** æ™ºèƒ½æœºå™¨äºº API ä¸æ”¯æŒè¯­éŸ³æ¶ˆæ¯ï¼Œå¦‚éœ€è¯­éŸ³åŠŸèƒ½è¯·ä½¿ç”¨ wechatcom_app é€šé“

```json
{
  "channel_type": "wechatcom_aibot",

  "wechatcom_corp_id": "ww1234567890abcdef",
  "wechatcom_aibot_token": "your-token",
  "wechatcom_aibot_aes_key": "your-aes-key",
  "wechatcom_aibot_port": 9899,
  "wechatcom_aibot_enable_stream": true,
  
  "model": "dify",
  "dify_api_base": "https://api.dify.ai/v1",
  "dify_api_key": "your-dify-api-key",
  "dify_app_type": "chatbot",
  
  "speech_recognition": true,
  "voice_to_text": "funasr",
  "funasr_url": "ws://localhost:10095",
  "funasr_model": "sensevoice",
  "funasr_enable_itn": true,
  
  "single_chat_prefix": [],
  "group_chat_prefix": ["@bot"],
  "group_name_white_list": ["ALL_GROUP"],
  "conversation_max_tokens": 2500
}
```

## ğŸ”§ é…ç½®å‚æ•°è¯¦è§£

### å¿…å¡«å‚æ•°

| å‚æ•° | è¯´æ˜ | è·å–æ–¹å¼ |
|------|------|----------|
| `wechatcom_corp_id` | ä¼ä¸š ID | ä¼ä¸šå¾®ä¿¡ç®¡ç†åå° â†’ æˆ‘çš„ä¼ä¸š â†’ ä¼ä¸šä¿¡æ¯ |
| `wechatcom_aibot_token` | å›è°ƒ Token | æ™ºèƒ½æœºå™¨äºº â†’ æ¥æ”¶æ¶ˆæ¯é…ç½® â†’ Token |
| `wechatcom_aibot_aes_key` | å›è°ƒ AES Key | æ™ºèƒ½æœºå™¨äºº â†’ æ¥æ”¶æ¶ˆæ¯é…ç½® â†’ EncodingAESKey |

### å¯é€‰å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `wechatcom_aibot_port` | `9899` | æœåŠ¡ç«¯å£ |
| `wechatcom_aibot_enable_stream` | `true` | æ˜¯å¦å¯ç”¨æµå¼æ¶ˆæ¯ |

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: URL éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š** "éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ URL é…ç½®"

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`ps aux | grep python`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ï¼š`netstat -tuln | grep 9899`
3. æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`
4. æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f logs/log-*.log`

### Q2: æ”¶ä¸åˆ°æ¶ˆæ¯

**å¯èƒ½åŸå› ï¼š**
- å›è°ƒ URL é…ç½®é”™è¯¯
- Token æˆ– AES Key ä¸åŒ¹é…
- æœåŠ¡æœªæ­£å¸¸è¿è¡Œ

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥å›è°ƒ URL æ˜¯å¦æ­£ç¡®
2. é‡æ–°éªŒè¯ URL
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### Q3: å›¾ç‰‡æ— æ³•æ˜¾ç¤º

**é”™è¯¯ä¿¡æ¯ï¼š** "Failed to decrypt image"

**è§£å†³æ–¹æ³•ï¼š**
```bash
pip install pycryptodome
```

### Q4: å›å¤è¶…æ—¶

**é”™è¯¯ä¿¡æ¯ï¼š** "æœºå™¨äººæœªå“åº”"

**åŸå› ï¼š** ä¼ä¸šå¾®ä¿¡è¦æ±‚ 5 ç§’å†…å“åº”

**è§£å†³æ–¹æ³•ï¼š**
- ä¼˜åŒ– LLM å“åº”é€Ÿåº¦
- ä½¿ç”¨æµå¼æ¶ˆæ¯
- æ£€æŸ¥ç½‘ç»œè¿æ¥

## ğŸŒ äº‘æœåŠ¡å™¨éƒ¨ç½²

### 1. å¼€æ”¾ç«¯å£

```bash
# Ubuntu/Debian
sudo ufw allow 9899

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=9899/tcp
sudo firewall-cmd --reload
```

### 2. ä½¿ç”¨ Nginx åå‘ä»£ç†ï¼ˆæ¨èï¼‰

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location /wxaibot/ {
        proxy_pass http://127.0.0.1:9899/wxaibot/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 3. é…ç½® HTTPSï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨ Let's Encrypt
sudo certbot --nginx -d your-domain.com
```

### 4. ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡

åˆ›å»º `/etc/systemd/system/sga-cow.service`ï¼š

```ini
[Unit]
Description=SGA-CoW Service
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/sga-cow
ExecStart=/usr/bin/python3 /path/to/sga-cow/app.py
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable sga-cow
sudo systemctl start sga-cow
sudo systemctl status sga-cow
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/log-*.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/log-*.log

# æŸ¥çœ‹æ™ºèƒ½æœºå™¨äººç›¸å…³æ—¥å¿—
grep wechatcom_aibot logs/log-*.log
```

### æ—¥å¿—çº§åˆ«

åœ¨ `config.json` ä¸­è®¾ç½®ï¼š

```json
{
  "debug": true
}
```

## ğŸ¯ ä¸‹ä¸€æ­¥

- âœ… åŸºç¡€æ–‡æœ¬å¯¹è¯å·²å¯ç”¨
- â³ é…ç½®æµå¼æ¶ˆæ¯å›å¤
- â³ æ·»åŠ æ¨¡æ¿å¡ç‰‡æ”¯æŒ
- â³ é›†æˆè¯­éŸ³è¯†åˆ«

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´ README](README.md)
- [ä¼ä¸šå¾®ä¿¡æ™ºèƒ½æœºå™¨äºº API æ–‡æ¡£](../../rules/ä¼ä¸šå¾®ä¿¡æ™ºèƒ½æœºå™¨äºº.md)
- [ä¼ä¸šå¾®ä¿¡å¼€å‘è€…æ–‡æ¡£](https://developer.work.weixin.qq.com/)

