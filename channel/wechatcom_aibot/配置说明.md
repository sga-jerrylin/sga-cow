# 企业微信智能机器人 - 配置说明

## 📋 需要的配置参数

根据你的截图，你只需要配置以下参数：

### 1. 企业ID (wechatcom_corp_id)

**获取位置：** 企业微信管理后台 → 我的企业 → 企业信息

**示例：** `ww1234567890abcdef`

### 2. Token (wechatcom_aibot_token)

**获取位置：** 你的截图中已经有了！

**你的值：** `1a6lJx1fXaosGJSC9d8KrvfOY`

### 3. EncodingAESKey (wechatcom_aibot_aes_key)

**获取位置：** 你的截图中已经有了！

**你的值：** `2z3WJWiJrxwW133O5A62mxUvTucKxxoxSyyrmwXBqWt`

---

## ✅ 完整配置示例

根据你的截图，你的 `config.json` 应该这样配置：

```json
{
  "channel_type": "wechatcom_aibot",
  
  "wechatcom_corp_id": "你的企业ID",
  "wechatcom_aibot_token": "1a6lJx1fXaosGJSC9d8KrvfOY",
  "wechatcom_aibot_aes_key": "2z3WJWiJrxwW133O5A62mxUvTucKxxoxSyyrmwXBqWt",
  "wechatcom_aibot_port": 9899,
  
  "model": "dify",
  "dify_api_key": "your-dify-api-key"
}
```

---

## ❌ 不需要的参数

之前我理解错了，以下参数**不需要**：

- ❌ `wechatcom_aibot_id` - 不需要
- ❌ `wechatcom_aibot_secret` - 不需要

企业微信智能机器人使用**被动回复模式**，不需要主动调用 API，所以不需要 Secret！

---

## 🔧 配置步骤

### 步骤 1: 获取企业ID

1. 登录企业微信管理后台
2. 点击「我的企业」
3. 在「企业信息」中找到「企业ID」
4. 复制企业ID

### 步骤 2: 填写 config.json

```json
{
  "channel_type": "wechatcom_aibot",
  "wechatcom_corp_id": "你的企业ID",
  "wechatcom_aibot_token": "1a6lJx1fXaosGJSC9d8KrvfOY",
  "wechatcom_aibot_aes_key": "2z3WJWiJrxwW133O5A62mxUvTucKxxoxSyyrmwXBqWt",
  "wechatcom_aibot_port": 9899,
  "model": "dify",
  "dify_api_key": "your-dify-api-key"
}
```

### 步骤 3: 配置回调 URL

在你的截图中，URL 那一栏填写：

```
http://你的服务器IP:9899/wxaibot/
```

**本地测试：** 如果是本地测试，可以使用 ngrok：

```bash
ngrok http 9899
```

然后使用 ngrok 提供的 URL：

```
https://xxxx.ngrok.io/wxaibot/
```

### 步骤 4: 启动服务

```bash
python app.py
```

### 步骤 5: 点击「创建」

在你的截图页面，点击「创建」按钮，企业微信会验证 URL 有效性。

---

## 🎯 参数对应关系

| 截图中的字段 | config.json 参数 | 说明 |
|-------------|-----------------|------|
| Token | `wechatcom_aibot_token` | 回调验证 Token |
| EncodingAESKey | `wechatcom_aibot_aes_key` | 消息加解密密钥 |
| URL | 无需配置 | 填写：`http://IP:9899/wxaibot/` |

---

## ⚠️ 常见问题

### Q1: 为什么不需要 Secret？

**A:** 企业微信智能机器人使用**被动回复模式**，类似于微信公众号：

- 用户发消息 → 企业微信推送到你的服务器 → 你的服务器回复
- 不需要主动调用企业微信 API
- 所以不需要 access_token，也就不需要 Secret

### Q2: 为什么不需要 aibot_id？

**A:** 智能机器人的 ID 会在每次回调消息中自动包含（`aibotid` 字段），不需要提前配置。

### Q3: 如果找不到企业ID怎么办？

**A:** 

1. 登录 https://work.weixin.qq.com/
2. 点击右上角「管理企业」
3. 在左侧菜单找到「我的企业」
4. 在「企业信息」中找到「企业ID」

---

## 📝 配置检查清单

在启动服务前，请确认：

- [ ] 已获取企业ID
- [ ] 已复制 Token 和 EncodingAESKey
- [ ] 已配置 config.json
- [ ] 已配置 Dify API Key
- [ ] 服务器端口 9899 已开放
- [ ] 已填写回调 URL

---

## 🚀 下一步

配置完成后：

1. 启动服务：`python app.py`
2. 在企业微信智能机器人配置页面点击「创建」
3. 等待 URL 验证成功
4. 在企业微信中测试对话

---

## 📞 需要帮助？

如果还有问题，请提供：

1. 企业微信管理后台的截图
2. 服务启动日志
3. 具体的错误信息

我会继续帮你解决！

